"use strict";(()=>{var e={};e.id=5409,e.ids=[5409],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},72254:e=>{e.exports=require("node:buffer")},87561:e=>{e.exports=require("node:fs")},88849:e=>{e.exports=require("node:http")},22286:e=>{e.exports=require("node:https")},87503:e=>{e.exports=require("node:net")},49411:e=>{e.exports=require("node:path")},97742:e=>{e.exports=require("node:process")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},65628:e=>{e.exports=require("node:zlib")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},77282:e=>{e.exports=require("process")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},71267:e=>{e.exports=require("worker_threads")},59796:e=>{e.exports=require("zlib")},5212:(e,r,i)=>{i.r(r),i.d(r,{headerHooks:()=>P,originalPathname:()=>A,requestAsyncStorage:()=>y,routeModule:()=>q,serverHooks:()=>k,staticGenerationAsyncStorage:()=>b,staticGenerationBailout:()=>E});var s={};i.r(s),i.d(s,{POST:()=>v,dynamic:()=>g}),i(95655);var t=i(83323),o=i(54647),a=i(66886),n=i(40160),l=i(15418),p=i(63330),u=i(23269),d=i.n(u);let m=async({email:e,emailType:r,userId:i})=>{try{let s=p.createTransport({service:"gmail",host:"smtp.gmail.com",port:465,secure:!0,auth:{user:process.env.MAILER_USER,pass:process.env.MAILER_PASS}}),t=d().sign({userId:i,emailType:r},process.env.TOKEN_SECRET,{expiresIn:"1h"}),o="",a="",n="http://localhost:3000";"VERIFY"===r?(o="Verify Your Email Address",a=`
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <h2 style="color: #2563eb;">Welcome to Our App!</h2>
          <p>Please click the button below to verify your email address:</p>
          <a href="${n}/verifyEmail?token=${t}" 
             style="display: inline-block; padding: 12px 24px; background: #2563eb; color: white; 
                    text-decoration: none; border-radius: 4px; font-weight: bold; margin: 10px 0;">
            Verify Email
          </a>
          <p>This link will expire in 1 hour.</p>
          <p>If you didn't request this, please ignore this email.</p>
          <hr style="border: none; border-top: 1px solid #e5e7eb; margin: 20px 0;">
          <p style="font-size: 12px; color: #6b7280;">\xa9 ${new Date().getFullYear()} Your App Name. All rights reserved.</p>
        </div>
      `):(o="Password Reset Request",a=`
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <h2 style="color: #dc2626;">Password Reset</h2>
          <p>Click the button below to reset your password:</p>
          <a href="${n}/reset-password?token=${t}" 
             style="display: inline-block; padding: 12px 24px; background: #dc2626; color: white; 
                    text-decoration: none; border-radius: 4px; font-weight: bold; margin: 10px 0;">
            Reset Password
          </a>
          <p>This link will expire in 1 hour.</p>
          <p>If you didn't request a password reset, please ignore this email.</p>
          <hr style="border: none; border-top: 1px solid #e5e7eb; margin: 20px 0;">
          <p style="font-size: 12px; color: #6b7280;">\xa9 ${new Date().getFullYear()} Your App Name. All rights reserved.</p>
        </div>
      `),await s.sendMail({from:`"SkillSwap" <${process.env.MAILER_FROM}>`,to:e,subject:o,html:a})}catch(e){throw console.error("Email sending failed:",e),Error("Email sending failed")}};var c=i(39381),f=i(78235),x=i(32805);let h=new f.lv(process.env.GOOGLE_CLIENT_ID),g="force-dynamic";async function v(e){try{await (0,c.Z)();let r=await e.json(),{name:i,email:s,password:t,googleToken:o,location:p,profilePhoto:u,isPublic:d,skillsOffered:f=[],skillsWanted:g=[],availability:v=[]}=r;if(o){let e=await h.verifyIdToken({idToken:o,audience:"612239180785-faktv1d6etg1clbi605lu0fiev4fq5vr.apps.googleusercontent.com"}),r=e.getPayload();if(!r?.email_verified||!r.email)return a.Z.json({error:"Google account not verified or email missing"},{status:401});let i=r.email.toLowerCase(),s=r.name||i.split("@")[0],t=await l.Z.findOne({$or:[{email:i},{googleId:r.sub}]});if(t)return a.Z.json({error:"User already exists",provider:t.authProvider},{status:409});let n=new l.Z({name:s,email:i,googleId:r.sub,isVerified:r.email_verified,authProvider:"google",profilePhoto:r.picture||u||"",location:p||"",isPublic:!1!==d,skillsOffered:f,skillsWanted:g,availability:v}),m=await n.save(),c={userId:m._id.toString(),email:m.email,name:m.name},{accessToken:w,refreshToken:q}=(0,x.X8)(c);m.refreshToken=q,await m.save();let y=a.Z.json({success:!0,message:"Google sign-up successful",accessToken:w,user:{id:m._id,email:m.email,name:m.name,isVerified:m.isVerified,profilePhoto:m.profilePhoto}});return y.cookies.set("refreshToken",q,{httpOnly:!0,secure:!0,sameSite:"strict",maxAge:6048e5}),y}{if(!i||!s||!t)return a.Z.json({error:"Name, email and password are required"},{status:400});if(t.length<8)return a.Z.json({error:"Password must be at least 8 characters"},{status:400});let e=s.toLowerCase(),r=await l.Z.findOne({email:e});if(r)return a.Z.json({error:"Email already in use",provider:r.authProvider},{status:409});let o=await n.ZP.hash(t,12),c=new l.Z({name:i.trim(),email:e,password:o,isVerified:!1,authProvider:"email",location:p||"",profilePhoto:u||"",isPublic:!1!==d,skillsOffered:f,skillsWanted:g,availability:v}),h=await c.save(),w={userId:h._id.toString(),email:h.email,name:h.name},{accessToken:q,refreshToken:y}=(0,x.X8)(w);h.refreshToken=y,await h.save(),await m({email:h.email,emailType:"VERIFY",userId:h._id.toString()});let b=a.Z.json({success:!0,message:"Registration successful. Please check your email.",accessToken:q,user:{id:h._id,email:h.email,name:h.name,isVerified:h.isVerified,profilePhoto:h.profilePhoto}});return b.cookies.set("refreshToken",y,{httpOnly:!0,secure:!0,sameSite:"strict",maxAge:6048e5}),b}}catch(e){return console.error("Signup Error:",e),a.Z.json({error:"An error occurred during signup",details:e instanceof Error?e.message:void 0},{status:500})}}let w=t.AppRouteRouteModule,q=new w({definition:{kind:o.x.APP_ROUTE,page:"/api/signup/route",pathname:"/api/signup",filename:"route",bundlePath:"app/api/signup/route"},resolvedPagePath:"C:\\Users\\HP\\Desktop\\NITROUS\\app\\api\\signup\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:b,serverHooks:k,headerHooks:P,staticGenerationBailout:E}=q,A="/api/signup/route"}};var r=require("../../../webpack-runtime.js");r.C(e);var i=e=>r(r.s=e),s=r.X(0,[4303,3330,3269,4900,5418,853],()=>i(5212));module.exports=s})();