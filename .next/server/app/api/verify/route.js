"use strict";(()=>{var e={};e.id=6976,e.ids=[6976],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},74703:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>x,originalPathname:()=>R,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>y,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>E});var i={};t.r(i),t.d(i,{GET:()=>d}),t(95655);var o=t(83323),n=t(54647),s=t(66886),a=t(23269),u=t.n(a),c=t(15418),l=t(39381);async function d(e){try{await (0,l.Z)();let r=e.nextUrl.searchParams.get("token"),t=e.headers.get("accept")?.includes("application/json");if(!r){if(t)return s.Z.json({error:"Token is required"},{status:400});return s.Z.redirect(new URL("/auth/verification-failed?error=missing_token",e.url))}let i=u().verify(r,process.env.TOKEN_SECRET);if("VERIFY"!==i.emailType){if(t)return s.Z.json({error:"Invalid token type"},{status:400});return s.Z.redirect(new URL("/auth/verification-failed?error=invalid_token_type",e.url))}let o=await c.Z.findById(i.userId);if(!o){if(t)return s.Z.json({error:"User not found"},{status:404});return s.Z.redirect(new URL("/auth/verification-failed?error=user_not_found",e.url))}if(o.isVerified){let{accessToken:r,refreshToken:i}=await p(o);if(t)return s.Z.json({success:!0,message:"Email already verified",accessToken:r});return f("/home",r,i,e)}o.isVerified=!0;let{accessToken:n,refreshToken:a}=await p(o);if(await o.save(),t)return s.Z.json({success:!0,message:"Email verified successfully",accessToken:n});return f("/home",n,a,e)}catch(t){console.error("Verification error:",t);let r=t instanceof Error?t.message:"Verification failed";if(e.headers.get("accept")?.includes("application/json"))return s.Z.json({error:r},{status:400});return s.Z.redirect(new URL(`/auth/verification-failed?error=${encodeURIComponent(r)}`,e.url))}}async function p(e){let r=u().sign({userId:e._id.toString(),email:e.email},process.env.ACCESS_TOKEN_SECRET,{expiresIn:"15m"}),t=u().sign({userId:e._id.toString()},process.env.REFRESH_TOKEN_SECRET,{expiresIn:"7d"});return e.refreshToken=t,await e.save(),{accessToken:r,refreshToken:t}}function f(e,r,t,i){let o=s.Z.redirect(new URL(e,i.url));return o.cookies.set("accessToken",r,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:900,path:"/"}),o.cookies.set("refreshToken",t,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800,path:"/"}),o}let v=o.AppRouteRouteModule,m=new v({definition:{kind:n.x.APP_ROUTE,page:"/api/verify/route",pathname:"/api/verify",filename:"route",bundlePath:"app/api/verify/route"},resolvedPagePath:"C:\\Users\\HP\\Desktop\\NITROUS\\app\\api\\verify\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:y,headerHooks:x,staticGenerationBailout:E}=m,R="/api/verify/route"},39381:(e,r,t)=>{t.d(r,{Z:()=>n});var i=t(11185),o=t.n(i);async function n(){try{await o().connect(process.env.MONGO_URI);let e=o().connection;e.on("connected",()=>{console.log("Mongo connected")}),e.on("error",e=>{console.log("MongoDb connection error",e),process.exit()})}catch(e){console.log("Error occured",e)}}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[4303,3269,5418],()=>t(74703));module.exports=i})();